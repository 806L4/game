<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org"></script>
    <link rel="apple-touch-icon" href="icon-512.png">
    <link rel="manifest" href="manifest.json">
    <title>Aviator Elite 806L4</title>
    <style>
        :root { --pink: #ff4b6e; --gold: #ffd700; --blue: #00d2ff; }
        body { margin: 0; background: #4facfe; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; color: #1a2a6c; }
        canvas { display: block; cursor: crosshair; }
        
        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .hud { position: absolute; top: 15px; left: 15px; z-index: 10; background: rgba(255,255,255,0.3); padding: 12px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.5); backdrop-filter: blur(10px); pointer-events: none; font-weight: bold; }
        progress { width: 100px; height: 12px; accent-color: var(--pink); border-radius: 6px; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(26, 42, 108, 0.7); z-index: 100; backdrop-filter: blur(8px); }
        .menu-card { background: white; padding: 30px; border-radius: 35px; text-align: center; border: 4px solid var(--pink); width: 85%; max-width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
        
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; max-height: 200px; overflow-y: auto; padding: 5px; }
        .shop-item { background: #f1f5f9; padding: 12px; border-radius: 20px; font-size: 12px; cursor: pointer; border: 2px solid transparent; transition: 0.3s; }
        .shop-item.active { border-color: var(--pink); background: #fff0f3; transform: scale(1.05); }
        
        .leaderboard { background: #f8fafc; border-radius: 15px; padding: 10px; margin-top: 10px; text-align: left; font-size: 13px; border: 1px solid #e2e8f0; }
        
        button { background: var(--pink); color: white; border: none; padding: 16px; border-radius: 50px; font-weight: bold; cursor: pointer; width: 100%; font-size: 18px; text-transform: uppercase; margin-top: 15px; box-shadow: 0 8px 20px rgba(255, 75, 110, 0.4); }
        .author { margin-top: 20px; font-size: 9px; color: #64748b; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="hud">
    üí∞ <span id="coinsHUD">0</span> | ‚≠ê <span id="scoreHUD">0</span><br>
    ‚õΩ <progress id="fuelBar" value="100" max="100"></progress>
</div>

<div id="mainMenu" class="overlay">
    <div class="menu-card">
        <h2 style="margin:0; color:var(--pink);">–ê–ù–ì–ê–† 806L4</h2>
        <p>–ë–∞–ª–∞–Ω—Å: <b id="totalCoins">0</b> üí∞</p>
        
        <div class="shop-grid" id="shopGrid"></div>

        <div class="leaderboard">
            <b>üèÜ –†–ï–ö–û–†–î–´:</b>
            <div id="topList">1. 0 | 2. 0 | 3. 0</div>
        </div>

        <button onclick="startGame()">–í–ó–õ–ï–¢ üöÄ</button>
        <div class="author">MADE BY <b>806L4</b> | SUPPORT BY AI</div>
    </div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const tg = window.Telegram?.WebApp;

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —ç–∫—Ä–∞–Ω
function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// –î–∞–Ω–Ω—ã–µ
const shipModels = [
    { name: "–°–ø—É—Ç–Ω–∏–∫", speed: 6, hp: 1, guns: 1, price: 0, color: '#ff4b6e' },
    { name: "–†–∞–∫–µ—Ç–∞", speed: 9, hp: 1, guns: 1, price: 300, color: '#00d2ff' },
    { name: "–¢–∞–Ω–∫", speed: 4, hp: 4, guns: 1, price: 800, color: '#4caf50' },
    { name: "–î—Ä–æ–Ω", speed: 7, hp: 2, guns: 2, price: 1500, color: '#ffd700' },
    { name: "–ó–≤–µ–∑–¥–∞", speed: 11, hp: 2, guns: 3, price: 3000, color: '#9c27b0' }
];

let userData = JSON.parse(localStorage.getItem('aviator_806_final')) || {
    coins: 0, scores: [0,0,0], unlocked: [true, false, false, false, false], current: 0
};

let score = 0, fuel = 100, gameActive = false, freezeTimer = 0;
let player = { x: 0, y: 0, w: 50, h: 50, shield: 0 };
let enemies = [], bullets = [], items = [], clouds = [];

// –û–±–ª–∞–∫–∞ –¥–ª—è –ø–∞—Ä–∞–ª–ª–∞–∫—Å–∞
for(let i=0; i<10; i++) clouds.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: 0.5 + Math.random()});

function drawCustomShip(x, y, color, isEnemy = false) {
    ctx.save();
    ctx.translate(x + 25, y + 25);
    if(isEnemy) ctx.rotate(Math.PI);

    // –ö–æ—Ä–ø—É—Å —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
    let grad = ctx.createLinearGradient(0, -25, 0, 25);
    grad.addColorStop(0, color);
    grad.addColorStop(1, '#000');
    ctx.fillStyle = grad;
    
    ctx.beginPath();
    ctx.moveTo(0, -25);
    ctx.bezierCurveTo(15, -10, 15, 20, 0, 25);
    ctx.bezierCurveTo(-15, 20, -15, -10, 0, -25);
    ctx.fill();

    // –ö—Ä—ã–ª—å—è
    ctx.fillStyle = color;
    ctx.fillRect(-25, 5, 50, 6);
    
    // –ö–∞–±–∏–Ω–∞ (—Å—Ç–µ–∫–ª–æ)
    ctx.fillStyle = isEnemy ? "red" : "#aaddff";
    ctx.beginPath();
    ctx.ellipse(0, -8, 5, 10, 0, 0, Math.PI*2);
    ctx.fill();
    
    ctx.restore();
}

function updateUI() {
    document.getElementById('totalCoins').innerText = userData.coins;
    document.getElementById('coinsHUD').innerText = userData.coins;
    document.getElementById('topList').innerText = userData.scores.map((s,i) => `${i+1}. ${s}`).join(' | ');
    
    const grid = document.getElementById('shopGrid');
    grid.innerHTML = '';
    shipModels.forEach((s, i) => {
        const div = document.createElement('div');
        div.className = `shop-item ${userData.current === i ? 'active' : ''}`;
        div.onclick = () => {
            if(userData.unlocked[i]) userData.current = i;
            else if(userData.coins >= s.price) {
                userData.coins -= s.price; userData.unlocked[i] = true; userData.current = i;
                tg?.HapticFeedback.notificationOccurred('success');
            }
            localStorage.setItem('aviator_806_final', JSON.stringify(userData));
            updateUI();
        };
        div.innerHTML = `<b>${s.name}</b><br>${userData.unlocked[i] ? '–í–´–ë–†–ê–¢–¨' : s.price+'üí∞'}`;
        grid.appendChild(div);
    });
}

function loop() {
    if(!gameActive) return;
    
    // –ù–µ–±–æ
    let sky = ctx.createLinearGradient(0, 0, 0, canvas.height);
    sky.addColorStop(0, '#4facfe'); sky.addColorStop(1, '#00f2fe');
    ctx.fillStyle = sky; ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // –ü–∞—Ä–∞–ª–ª–∞–∫—Å –æ–±–ª–∞–∫–∞
    ctx.fillStyle = "rgba(255,255,255,0.4)";
    clouds.forEach(c => {
        c.y += c.s; if(c.y > canvas.height) { c.y = -60; c.x = Math.random()*canvas.width; }
        ctx.beginPath(); ctx.arc(c.x, c.y, 25, 0, Math.PI*2); ctx.fill();
    });

    // –ò–≥—Ä–æ–∫ –∏ —â–∏—Ç
    if(player.shield > 0) {
        ctx.strokeStyle = var(--blue); ctx.lineWidth = 3;
        ctx.beginPath(); ctx.arc(player.x+25, player.y+25, 35, 0, Math.PI*2); ctx.stroke();
    }
    drawCustomShip(player.x, player.y, shipModels[userData.current].color);

    // –ê–≤—Ç–æ—Å—Ç—Ä–µ–ª—å–±–∞
    if(Date.now() % 150 < 20) {
        const s = shipModels[userData.current];
        bullets.push({x: player.x + 23, y: player.y, w: 4, h: 12});
        if(s.guns >= 2) { bullets.push({x:player.x, y:player.y+15, w:4, h:12}); bullets.push({x:player.x+46, y:player.y+15, w:4, h:12}); }
    }

    // –í—Ä–∞–≥–∏
    if(Math.random() < 0.03 && freezeTimer <= 0) enemies.push({x: Math.random()*(canvas.width-50), y: -60, w: 50, h: 50});
    enemies.forEach((en, i) => {
        if(freezeTimer <= 0) en.y += (4 + score/1000);
        drawCustomShip(en.x, en.y, "#333", true);
        if(intersect(player, en)) {
            if(player.shield > 0) { player.shield--; enemies.splice(i, 1); tg?.HapticFeedback.impactOccurred('medium'); }
            else endGame();
        }
        bullets.forEach((b, bi) => {
            if(intersect(b, en)) { enemies.splice(i, 1); bullets.splice(bi, 1); score += 10; userData.coins += 2; tg?.HapticFeedback.impactOccurred('light'); }
        });
        if(en.y > canvas.height) enemies.splice(i, 1);
    });

    // –ü—É–ª–∏
    ctx.fillStyle = "orange";
    bullets.forEach((b, i) => { b.y -= 10; ctx.fillRect(b.x, b.y, b.w, b.h); if(b.y < -20) bullets.splice(i, 1); });

    // –ë–û–ù–£–°–´ (–≠–º–æ–¥–∑–∏)
    if(Math.random() < 0.015) {
        const types = ['‚õΩ','üõ°Ô∏è','‚ùÑÔ∏è','üí∞'];
        items.push({x: Math.random()*(canvas.width-30), y: -50, w: 35, h: 35, t: types[Math.floor(Math.random()*types.length)]});
    }
    items.forEach((it, i) => {
        it.y += 3;
        ctx.font = "30px serif"; ctx.fillText(it.t, it.x, it.y);
        if(intersect(player, it)) {
            if(it.t === '‚õΩ') fuel = Math.min(100, fuel + 30);
            if(it.t === 'üõ°Ô∏è') player.shield++;
            if(it.t === '‚ùÑÔ∏è') freezeTimer = 200;
            if(it.t === 'üí∞') userData.coins += 100;
            items.splice(i, 1);
            tg?.HapticFeedback.notificationOccurred('success');
        }
    });

    if(freezeTimer > 0) freezeTimer--;
    fuel -= 0.08;
    document.getElementById('scoreHUD').innerText = score;
    document.getElementById('fuelBar').value = fuel;
    if(fuel <= 0) endGame();
    requestAnimationFrame(loop);
}

const intersect = (r1, r2) => !(r2.x > r1.x + r1.w || r2.x + r2.w < r1.x || r2.y > r1.y + r1.h || r2.y + r2.h < r1.y);

const move = (e) => {
    let x = e.clientX || (e.touches && e.touches[0].clientX);
    let y = e.clientY || (e.touches && e.touches[0].clientY);
    if(gameActive) { player.x = x - 25; player.y = y - 25; }
};
window.addEventListener('pointermove', move);
window.addEventListener('pointerdown', move);

function startGame() {
    gameActive = true; score = 0; fuel = 100; freezeTimer = 0; enemies = []; bullets = []; items = [];
    player.shield = shipModels[userData.current].hp - 1;
    document.getElementById('mainMenu').style.display = 'none';
    tg?.expand();
    loop();
}

function endGame() {
    gameActive = false;
    userData.scores.push(score);
    userData.scores.sort((a,b) => b - a);
    userData.scores = userData.scores.slice(0, 3);
    localStorage.setItem('aviator_806_final', JSON.stringify(userData));
    updateUI();
    document.getElementById('mainMenu').style.display = 'flex';
    tg?.HapticFeedback.notificationOccurred('error');
}

updateUI();
</script>
</body>
</html>
