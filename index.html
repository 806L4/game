<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-512.png">
    <link rel="manifest" href="manifest.json">
    <title>Aviator 806L4</title>
    <style>
        :root { --pink: #ff4b6e; --gold: #ffd700; }
        body { margin: 0; background: #0b0e14; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; color: white; }
        canvas { display: block; }
        .hud { position: absolute; top: 10px; left: 10px; z-index: 10; font-size: 14px; background: rgba(0,0,0,0.6); padding: 12px; border-radius: 12px; pointer-events: none; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.85); z-index: 100; }
        .menu-card { background: #1a1c23; padding: 25px; border-radius: 24px; text-align: center; border: 2px solid var(--pink); width: 85%; max-width: 380px; }
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 15px 0; max-height: 220px; overflow-y: auto; }
        .shop-item { background: #252833; padding: 10px; border-radius: 15px; font-size: 11px; cursor: pointer; border: 2px solid transparent; }
        .shop-item.active { border-color: var(--pink); background: #351a24; }
        button { background: var(--pink); color: white; border: none; padding: 14px; border-radius: 50px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        .author { margin-top: 15px; font-size: 8px; color: rgba(255,255,255,0.3); letter-spacing: 1px; }
        #pwa-banner { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: white; color: #333; padding: 20px; border-radius: 20px; z-index: 1000; display: none; text-align: center; border: 3px solid var(--pink); }
    </style>
</head>
<body>

<div id="pwa-banner">
    <h3 style="color:var(--pink);margin:0">–£—Å—Ç–∞–Ω–æ–≤–∏ –∏–≥—Ä—É! üì±</h3>
    <p style="font-size:12px">–ù–∞–∂–º–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" -> "–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π" –∏–ª–∏ –∫–Ω–æ–ø–∫—É –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
    <button id="pwa-btn">–£–°–¢–ê–ù–û–í–ò–¢–¨</button>
    <button onclick="this.parentElement.style.display='none'" style="background:#555;font-size:10px">–ü–û–ó–ñ–ï</button>
</div>

<div class="hud">üí∞ <span id="coinsHUD">0</span> | ‚≠ê <span id="scoreHUD">0</span><br>‚õΩ <progress id="fuelBar" value="100" max="100" style="width:80px;"></progress></div>

<div id="mainMenu" class="overlay">
    <div class="menu-card">
        <h2 style="margin:0; color:var(--pink);">–ê–ù–ì–ê–† –°–ê–ú–û–õ–ï–¢–û–í</h2>
        <p>–ë–∞–ª–∞–Ω—Å: <b id="totalCoins" style="color:var(--gold);">0</b> üí∞</p>
        <div class="shop-grid" id="shopGrid"></div>
        <div style="font-size: 11px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 10px;">üèÜ –¢–û–ü: <span id="bestScoresList">0</span></div>
        <button id="startBtn">–í–ó–õ–ï–¢ üöÄ</button>
        <div class="author">MADE BY <b>806L4</b> WITH STRONG SUPPORT FROM AI</div>
    </div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const shipModels = [
    { name: "–ö—É–∫—É—Ä—É–∑–Ω–∏–∫", speed: 5, hp: 1, guns: 1, price: 0, color: '#ff4b6e', icon: 'üõ©Ô∏è' },
    { name: "–ò—Å—Ç—Ä–µ–±–∏—Ç–µ–ª—å", speed: 8, hp: 1, guns: 1, price: 300, color: '#00d2ff', icon: '‚úàÔ∏è' },
    { name: "–ë–æ–º–±–µ—Ä", speed: 4, hp: 3, guns: 1, price: 800, color: '#4caf50', icon: 'üöÄ' },
    { name: "–®—Ç—É—Ä–º–æ–≤–∏–∫", speed: 7, hp: 2, guns: 2, price: 1500, color: '#ffd700', icon: 'üöÅ' },
    { name: "–§–∞–Ω—Ç–æ–º-X", speed: 10, hp: 2, guns: 3, price: 3000, color: '#9c27b0', icon: 'üõ∏' }
];

let userData = JSON.parse(localStorage.getItem('aviator_806L4_final')) || {
    coins: 0, bestScores: [], unlockedShips: [true, false, false, false, false], currentShipIndex: 0
};

let score = 0, fuel = 100, gameActive = false, freezeTimer = 0;
let player = { x: canvas.width/2-20, y: canvas.height-100, w: 40, h: 40, shield: 0 };
let enemies = [], bullets = [], items = [];

function updateUI() {
    document.getElementById('totalCoins').innerText = userData.coins;
    document.getElementById('coinsHUD').innerText = userData.coins;
    document.getElementById('bestScoresList').innerText = userData.bestScores.slice(0,3).join(', ') || '0';
    const grid = document.getElementById('shopGrid');
    grid.innerHTML = '';
    shipModels.forEach((s, i) => {
        const div = document.createElement('div');
        div.className = `shop-item ${userData.unlockedShips[i] ? '' : 'locked'} ${userData.currentShipIndex === i ? 'active' : ''}`;
        div.innerHTML = `<span style="font-size:20px">${s.icon}</span><br><b>${s.name}</b><br><span style="color:var(--gold)">${userData.unlockedShips[i] ? '–í–´–ë–†–ê–¢–¨' : s.price+'üí∞'}</span>`;
        div.onclick = () => {
            if (userData.unlockedShips[i]) { userData.currentShipIndex = i; }
            else if (userData.coins >= s.price) { userData.coins -= s.price; userData.unlockedShips[i] = true; userData.currentShipIndex = i; }
            localStorage.setItem('aviator_806L4_final', JSON.stringify(userData)); updateUI();
        };
        grid.appendChild(div);
    });
}

function drawPlane(x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x + 15, y, 10, 40); ctx.fillRect(x, y + 15, 40, 8); ctx.fillRect(x + 10, y + 35, 20, 5);
}

function intersect(r1, r2) { return !(r2.x > r1.x + r1.w || r2.x + r2.w < r1.x || r2.y > r1.y + r1.h || r2.y + r2.h < r1.y); }

function loop() {
    if(!gameActive) return;
    ctx.fillStyle = "#0b0e14"; ctx.fillRect(0, 0, canvas.width, canvas.height);
    if(freezeTimer > 0) freezeTimer--;

    drawPlane(player.x, player.y, shipModels[userData.currentShipIndex].color);
    if(player.shield > 0) { ctx.strokeStyle = "#00d2ff"; ctx.strokeRect(player.x-5, player.y-5, 50, 50); }

    if(Math.random() < 0.03 && freezeTimer === 0) enemies.push({x: Math.random()*(canvas.width-40), y: -50, w: 40, h: 40});
    enemies.forEach((en, i) => {
        if(freezeTimer === 0) en.y += (4 + score/1000);
        drawPlane(en.x, en.y, "#333");
        if(intersect(player, en)) { if(player.shield > 0) { player.shield--; enemies.splice(i,1); } else { gameActive = false; document.getElementById('mainMenu').style.display = 'flex'; userData.bestScores.push(score); userData.bestScores.sort((a,b)=>b-a); localStorage.setItem('aviator_806L4_final', JSON.stringify(userData)); updateUI(); } }
        bullets.forEach((b, bi) => { if(intersect(b, en)) { userData.coins += 5; enemies.splice(i,1); bullets.splice(bi,1); score += 10; } });
        if(en.y > canvas.height) enemies.splice(i, 1);
    });

    bullets.forEach((b, i) => { b.y -= 10; if(b.vx) b.x += b.vx; ctx.fillStyle = "yellow"; ctx.fillRect(b.x, b.y, b.w, b.h); if(b.y < 0) bullets.splice(i,1); });

    if(Math.random() < 0.01) items.push({x: Math.random()*(canvas.width-30), y: -50, w: 30, h: 30, t: ['f','c','s','z'][Math.floor(Math.random()*4)]});
    items.forEach((it, i) => {
        it.y += 3;
        ctx.font = "20px serif"; ctx.fillText(it.t==='f'?'‚õΩ':it.t==='c'?'üí∞':it.t==='s'?'üõ°Ô∏è':'‚ùÑÔ∏è', it.x, it.y);
        if(intersect(player, it)) {
            if(it.t==='f') fuel = Math.min(100, fuel + 30);
            if(it.t==='c') userData.coins += 50;
            if(it.t==='s') player.shield++;
            if(it.t==='z') freezeTimer = 180;
            items.splice(i, 1);
        }
    });

    fuel -= 0.08;
    document.getElementById('scoreHUD').innerText = score;
    document.getElementById('fuelBar').value = fuel;
    if(fuel <= 0) { gameActive = false; document.getElementById('mainMenu').style.display = 'flex'; updateUI(); }
    requestAnimationFrame(loop);
}

document.getElementById('startBtn').onclick = () => {
    gameActive = true; score = 0; fuel = 100; freezeTimer = 0;
    enemies = []; bullets = []; items = [];
    player.shield = shipModels[userData.currentShipIndex].hp - 1;
    document.getElementById('mainMenu').style.display = 'none';
    loop();
};

window.addEventListener('mousemove', (e) => { if(gameActive) { player.x = e.clientX-20; player.y = e.clientY-20; } });
window.addEventListener('touchmove', (e) => { if(gameActive) { e.preventDefault(); player.x = e.touches[0].clientX-20; player.y = e.touches[0].clientY-20; } }, {passive:false});
window.addEventListener('mousedown', () => {
    if(!gameActive) return;
    const ship = shipModels[userData.currentShipIndex];
    if(ship.guns >= 1) bullets.push({x: player.x+18, y: player.y, w:4, h:10});
    if(ship.guns >= 2) { bullets.push({x: player.x+5, y: player.y+10, w:4, h:10}); bullets.push({x: player.x+31, y: player.y+10, w:4, h:10}); }
});

updateUI();
</script>
</body>
</html>
