<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aviator Elite 806L4</title>
    <link rel="icon" type="image/png" href="/game/icon-512.png">
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        :root { --pink: #ff4b6e; --dark: #0f172a; --gold: #ffd700; }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-touch-callout: none; user-select: none; }

        body { background: var(--dark); color: white; font-family: sans-serif; overflow: hidden; touch-action: none; width: 100vw; height: 100vh; }

        /* –ì–õ–ê–í–ù–û–ï: –•–æ–ª—Å—Ç –ø–æ–¥ –º–µ–Ω—é */
        canvas { position: absolute; top: 0; left: 0; z-index: 1; display: block; }

        /* –ò–ù–¢–ï–†–§–ï–ô–° –ü–û–í–ï–†–• –í–°–ï–ì–û */
        .overlay {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            background: rgba(15, 23, 42, 0.9);
            z-index: 100; /* –°–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π —Å–ª–æ–π */
            backdrop-filter: blur(10px);
        }

        .menu-card {
            background: #1e293b; padding: 25px; border-radius: 25px;
            text-align: center; border: 2px solid var(--pink);
            width: 90%; max-width: 400px;
            pointer-events: all;
        }

        .hud { position: absolute; top: 50px; left: 20px; z-index: 10; pointer-events: none; font-family: monospace; }

        .tabs { display: flex; gap: 5px; margin: 15px 0; }
        .tab-btn {
            flex: 1; padding: 12px; border-radius: 10px; border: none;
            background: rgba(255,255,255,0.1); color: white;
            font-weight: bold; cursor: pointer; font-size: 12px;
        }
        .tab-btn.active { background: var(--pink); }

        .content { display: none; max-height: 200px; overflow-y: auto; margin: 10px 0; }
        .content.active { display: block; }

        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .shop-item { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 2px solid transparent; cursor: pointer; }
        .shop-item.selected { border-color: var(--pink); background: rgba(255,75,110,0.1); }

        input { background: #0f172a; border: 1px solid #334155; padding: 15px; width: 100%; border-radius: 12px; color: white; text-align: center; margin-bottom: 10px; font-size: 16px; }
        .btn-start { background: var(--pink); color: white; border: none; padding: 20px; border-radius: 50px; font-weight: bold; width: 100%; font-size: 20px; cursor: pointer; }
    </style>
</head>
<body>

<div class="hud">üí∞ <span id="hCoins">0</span> | ‚≠ê <span id="hScore">0</span></div>

<div id="mainMenu" class="overlay">
    <div class="menu-card">
        <h2 id="shipTitle">AVIATOR ELITE</h2>
        <p id="rankLabel" style="font-size:12px; color:var(--pink); margin-bottom:10px;">–ó–í–ê–ù–ò–ï: –ö–£–†–°–ê–ù–¢</p>

        <div class="tabs">
            <button class="tab-btn active" onclick="ui.tab('shop', this)">–ê–ù–ì–ê–†</button>
            <button class="tab-btn" onclick="ui.tab('top', this)">–¢–û–ü</button>
            <button class="tab-btn" onclick="ui.tab('set', this)">–ù–ò–ö</button>
        </div>

        <div id="tab-shop" class="content active"><div class="shop-grid" id="sGrid"></div></div>
        <div id="tab-top" class="content" id="topList">–†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç...</div>
        <div id="tab-set" class="content">
            <input type="text" id="nick" placeholder="–¢–≤–æ–π –Ω–∏–∫" maxlength="10">
        </div>

        <button class="btn-start" onclick="game.start()">–ü–û–ï–•–ê–õ–ò! üöÄ</button>
    </div>
</div>

<canvas id="game"></canvas>

<script>
// --- –ö–õ–Æ–ß–ò  ---
const SB_URL = 'https://mnfddistqwbtmcyroojg.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1uZmRkaXN0cXdidG1jeXJvb2pnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0MDYzMjYsImV4cCI6MjA4Njk4MjMyNn0.8TMxgNPykwOCIVGfLLKv2aFnVukt4UueHuLDOs3qt3w';
const sb = (SB_URL) ? supabase.createClient(SB_URL, SB_KEY) : null;

// --- –°–ê–ú–û–õ–ï–¢–´ ---
const ships = [
    { n: "–Ø–∫-52", p: 0, c: "#ff4b6e" },
    { n: "–ú–∏–ì-15", p: 1000, c: "#94a3b8" },
    { n: "–°—É-27", p: 5000, c: "#3b82f6" },
    { n: "ORIGIN", p: 0, c: "gold", adm: true }
];

let db = JSON.parse(localStorage.getItem('avi_v100')) || { n: "Pilot", c: 0, u: [true, false, false, false], cur: 0, hi: 0 };
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let bullets = [], enemies = [];

const ui = {
    tab: (id, el) => {
        // –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        // –í–∫–ª—é—á–∞–µ–º –Ω—É–∂–Ω—ã–π
        document.getElementById('tab-' + id).classList.add('active');
        el.classList.add('active');
    },
    render: () => {
        const g = document.getElementById('sGrid');
        g.innerHTML = '';
        ships.forEach((s, i) => {
            if(s.adm && db.n !== "806L4") return; // –°–µ–∫—Ä–µ—Ç–∫–∞
            const d = document.createElement('div');
            d.className = `shop-item ${db.cur === i ? 'selected' : ''}`;
            d.innerHTML = `<b>${s.n}</b><br>${db.u[i] || s.adm ? 'OK' : s.p+'üí∞'}`;
            d.onclick = () => {
                if(db.u[i] || s.adm) db.cur = i;
                else if(db.c >= s.p) { db.c -= s.p; db.u[i] = true; db.cur = i; }
                ui.save(); ui.render();
            };
            g.appendChild(d);
        });
        document.getElementById('hCoins').innerText = db.c;
        document.getElementById('nick').value = db.n;
    },
    save: () => localStorage.setItem('avi_v100', JSON.stringify(db))
};

const game = {
    active: false,
    p: { x: 0, y: 0, tx: 0, ty: 0 },
    start: () => {
        db.n = document.getElementById('nick').value || db.n;
        ui.save();
        document.getElementById('mainMenu').style.display = 'none';
        game.active = true;
        game.p.x = canvas.width/2; game.p.y = canvas.height-100;
        game.loop();
    },
    loop: () => {
        if(!game.active) return;
        ctx.fillStyle = '#0f172a'; ctx.fillRect(0,0,canvas.width, canvas.height);

        // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
        game.p.x += (game.p.tx - game.p.x) * 0.15;
        game.p.y += (game.p.ty - game.p.y) * 0.15;

        // –†–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞
        ctx.fillStyle = ships[db.cur].c;
        ctx.beginPath();
        ctx.arc(game.p.x, game.p.y, 20, 0, Math.PI*2);
        ctx.fill();

        requestAnimationFrame(game.loop);
    }
};

// –£–ü–†–ê–í–õ–ï–ù–ò–ï
const move = (e) => {
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const y = e.touches ? e.touches[0].clientY : e.clientY;
    game.p.tx = x; game.p.ty = y;
};
window.addEventListener('mousemove', move);
window.addEventListener('touchmove', (e) => { move(e); }, {passive:false});

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});

// –ó–ê–ü–£–°–ö
window.onload = () => {
    window.dispatchEvent(new Event('resize'));
    ui.render();
};
</script>
</body>
</html>
