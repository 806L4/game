<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- SDK Telegram -->
    <script src="https://telegram.org"></script>
    
    <!-- PWA / iOS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-512.png">
    <link rel="manifest" href="manifest.json">
    
    <title>Aviator Elite 806L4</title>
    <style>
        :root { --pink: #ff4b6e; --gold: #ffd700; --blue: #00d2ff; }
        
        /* –ó–∞–ø—Ä–µ—Ç —Å–∫—Ä–æ–ª–ª–∞ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –≤ TG */
        * { box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        
        body { 
            margin: 0; background: #0b0e14; overflow: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            touch-action: none; position: fixed; width: 100%; height: 100%; 
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* HUD - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —á–µ–ª–∫—É iPhone –∏ –∫–Ω–æ–ø–∫–∏ TG */
        .hud { 
            position: absolute; top: env(safe-area-inset-top, 40px); left: 15px; 
            z-index: 10; background: rgba(255,255,255,0.15); padding: 10px; 
            border-radius: 12px; backdrop-filter: blur(10px); color: white; 
            border: 1px solid rgba(255,255,255,0.2); pointer-events: none; 
        }

        #event-bar { 
            position: absolute; top: 0; left: 0; width: 100%; 
            background: rgba(0,0,0,0.8); color: var(--blue); font-size: 10px; 
            padding: 4px 0; z-index: 200; overflow: hidden; border-bottom: 1px solid var(--pink); 
        }

        .overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: flex; align-items: center; justify-content: center; 
            background: rgba(10, 20, 50, 0.9); z-index: 100; 
        }

        .menu-card { 
            background: #1a1c23; padding: 25px; border-radius: 30px; 
            text-align: center; border: 2px solid var(--pink); width: 88%; 
            max-width: 360px; color: white; 
        }

        .shop-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; 
            margin: 15px 0; max-height: 180px; overflow-y: auto; 
        }

        .shop-item { 
            background: #252833; padding: 10px; border-radius: 15px; 
            font-size: 11px; cursor: pointer; border: 2px solid transparent; 
        }

        .shop-item.active { border-color: var(--pink); background: #351a24; }

        input { 
            background: #0b0e14; color: white; width: 90%; padding: 12px; 
            margin: 10px 0; border-radius: 12px; border: 1px solid var(--pink); 
            text-align: center; font-size: 16px; 
        }

        button { 
            background: var(--pink); color: white; border: none; 
            padding: 15px; border-radius: 50px; font-weight: bold; 
            cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; 
        }
    </style>
</head>
<body>

<div id="event-bar"><div id="event-text" style="display: inline-block; white-space: nowrap; animation: scroll 25s linear infinite;">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram Cloud... –ü–∏–ª–æ—Ç 806L4 –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω... –û–∂–∏–¥–∞–Ω–∏–µ –≤–∑–ª–µ—Ç–∞.</div></div>

<div class="hud">üí∞ <span id="coinsHUD">0</span> | ‚≠ê <span id="scoreHUD">0</span> | ‚õΩ <progress id="fuelBar" value="100" max="100" style="width:70px"></progress></div>

<div id="mainMenu" class="overlay">
    <div class="menu-card">
        <h2 id="menuTitle" style="margin:0; color:var(--pink);">–ê–ù–ì–ê–† 806L4</h2>
        <input type="text" id="playerName" placeholder="–¢–≤–æ–π –Ω–∏–∫" maxlength="12">
        <div class="shop-grid" id="shopGrid"></div>
        <button id="startBtn">–í–ó–õ–ï–¢ üöÄ</button>
        <div style="font-size:9px; margin-top:15px; opacity:0.5;">TG WebApp & Browser Edition | by 806L4</div>
    </div>
</div>

<canvas id="game"></canvas>

<script>
(function() {
    const tg = window.Telegram?.WebApp;
    if (tg) {
        tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ Telegram
        tg.enableClosingConfirmation(); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
        tg.headerColor = '#0b0e14';
    }

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    // --- –ü–ê–†–ê–ú–ï–¢–†–´ –ü–õ–ê–¢–§–û–†–ú–´ ---
    let userData = JSON.parse(localStorage.getItem('aviator_cross_v1')) || {
        n: "", c: 100, u: [true, false, false, false, false, false], cur: 0, s: []
    };

    const shipModels = [
        { name: "–°–ø—É—Ç–Ω–∏–∫", guns: 1, price: 0, color: '#ff4b6e' },
        { name: "–†–∞–∫–µ—Ç–∞", guns: 1, price: 300, color: '#00d2ff' },
        { name: "–¢–∞–Ω–∫", guns: 1, price: 800, color: '#4caf50' },
        { name: "–î—Ä–æ–Ω", guns: 2, price: 1500, color: '#ffd700' },
        { name: "–§–∞–Ω—Ç–æ–º-X", guns: 3, price: 3000, color: '#9c27b0' },
        { name: "ORIGIN", guns: 4, price: 0, color: 'rgb', admin: true }
    ];

    let score = 0, fuel = 100, active = false, hue = 0, lastMilestone = 0;
    let player = { x: 0, y: 0, w: 45, h: 45 };
    let enemies = [], bullets = [], items = [];

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.x = canvas.width / 2 - 22;
        player.y = canvas.height - 150;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- –ó–í–£–ö –ò –í–ò–ë–†–ê–¶–ò–Ø ---
    function vibrate(type = 'light') {
        if (!tg) { if (navigator.vibrate) navigator.vibrate(50); return; }
        if (type === 'error') tg.HapticFeedback.notificationOccurred('error');
        else tg.HapticFeedback.impactOccurred(type);
    }

    function updateUI() {
        const nick = document.getElementById('playerName').value.toLowerCase().trim();
        const isAdm = (nick === '806l4');
        document.getElementById('menuTitle').innerHTML = isAdm ? '<span style="color:#00ff41">[ADMIN]</span> 806L4' : '–ê–ù–ì–ê–† 806L4';
        document.getElementById('coinsHUD').innerText = userData.c;
        
        const grid = document.getElementById('shopGrid');
        grid.innerHTML = '';
        shipModels.forEach((s, i) => {
            if(s.admin && !isAdm) return;
            const div = document.createElement('div');
            div.className = `shop-item ${userData.cur === i ? 'active' : ''}`;
            div.onclick = () => {
                if(userData.u[i] || (s.admin && isAdm)) { userData.cur = i; vibrate(); }
                else if(userData.c >= s.price) {
                    userData.c -= s.price; userData.u[i] = true; userData.cur = i;
                    vibrate('success');
                }
                save(); updateUI();
            };
            div.innerHTML = `<b>${s.name}</b><br>${userData.u[i] || (s.admin && isAdm) ? '–í–´–ë–†–ê–¢–¨' : s.price+'üí∞'}`;
            grid.appendChild(div);
        });
    }

    function loop() {
        if(!active) return;
        ctx.fillStyle = "#0b0e14"; ctx.fillRect(0,0, canvas.width, canvas.height);

        // –ò–≥—Ä–æ–∫
        if(shipModels[userData.cur].color === 'rgb') {
            hue = (hue + 2) % 360; ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
        } else ctx.fillStyle = shipModels[userData.cur].color;
        ctx.fillRect(player.x, player.y, 45, 45);

        // –°—Ç—Ä–µ–ª—å–±–∞
        if(Date.now() % 150 < 20) bullets.push({x: player.x+20, y: player.y, w:5, h:12});

        // –í—Ä–∞–≥–∏
        if(Math.random() < 0.035) enemies.push({x: Math.random()*(canvas.width-40), y: -50});
        enemies.forEach((en, i) => {
            en.y += (4 + score/1200);
            ctx.fillStyle = "#444"; ctx.fillRect(en.x, en.y, 40, 40);
            if(intersect(player, {x:en.x, y:en.y, w:40, h:40})) { vibrate('error'); endGame(); }
            bullets.forEach((b, bi) => {
                if(intersect(b, {x:en.x, y:en.y, w:40, h:40})) {
                    enemies.splice(i,1); bullets.splice(bi,1); 
                    score += 10; userData.c += 2;
                    if(score >= lastMilestone + 1000) { lastMilestone += 1000; vibrate('heavy'); }
                }
            });
            if(en.y > canvas.height) enemies.splice(i, 1);
        });

        bullets.forEach((b, i) => { b.y -= 12; ctx.fillStyle = "yellow"; ctx.fillRect(b.x, b.y, b.w, b.h); if(b.y < -50) bullets.splice(i,1); });

        // –ü—Ä–µ–¥–º–µ—Ç—ã
        if(Math.random() < 0.01) items.push({x: Math.random()*canvas.width, y: -50, t: Math.random() > 0.3 ? '‚õΩ' : 'üí∞'});
        items.forEach((it, i) => {
            it.y += 3.5; ctx.font = "24px serif"; ctx.fillText(it.t, it.x, it.y);
            if(intersect(player, {x:it.x, y:it.y, w:25, h:25})) {
                if(it.t === '‚õΩ') fuel = Math.min(100, fuel + 30); else userData.c += 50;
                vibrate('light'); items.splice(i, 1);
            }
        });

        fuel -= 0.08;
        document.getElementById('scoreHUD').innerText = score;
        document.getElementById('fuelBar').value = fuel;
        if(fuel <= 0) endGame();
        requestAnimationFrame(loop);
    }

    function intersect(r1, r2) { return !(r2.x > r1.x + 45 || r2.x + 40 < r1.x || r2.y > r1.y + 45 || r2.y + 40 < r1.y); }
    
    function move(e) {
        if(!active) return;
        let x = (e.clientX || e.touches?.[0]?.clientX);
        let y = (e.clientY || e.touches?.[0]?.clientY);
        if(x) { player.x = x - 22; player.y = y - 22; }
    }
    window.addEventListener('pointermove', move);
    window.addEventListener('touchstart', (e) => { if(active) e.preventDefault(); }, {passive: false});

    document.getElementById('startBtn').onclick = () => {
        const n = document.getElementById('playerName').value.trim();
        if(!n) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!");
        userData.n = n; active = true; score = 0; fuel = 100; lastMilestone = 0;
        enemies = []; bullets = []; items = [];
        document.getElementById('mainMenu').style.display = 'none';
        save(); loop();
    };

    function endGame() { active = false; updateUI(); document.getElementById('mainMenu').style.display = 'flex'; save(); }
    function save() { localStorage.setItem('aviator_cross_v1', JSON.stringify(userData)); }

    if(userData.n) document.getElementById('playerName').value = userData.n;
    document.getElementById('playerName').oninput = updateUI;
    updateUI();
})();
</script>
</body>
</html>
