<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="icon-512.png">
    <link rel="manifest" href="manifest.json">
    <title>Aviator Elite 806L4</title>
    <style>
        :root { --pink: #ff4b6e; --gold: #ffd700; --sky: #1a2a6c; }
        body { margin: 0; background: var(--sky); overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; color: white; }
        canvas { display: block; cursor: none; } /* –°–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä –¥–ª—è –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è */
        
        .hud { position: absolute; top: 15px; left: 15px; z-index: 10; background: rgba(0,0,0,0.5); padding: 12px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); pointer-events: none; backdrop-filter: blur(5px); }
        progress { width: 100px; height: 10px; accent-color: var(--pink); border-radius: 5px; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(10, 20, 50, 0.9); z-index: 100; }
        .menu-card { background: #16213e; padding: 30px; border-radius: 30px; text-align: center; border: 2px solid var(--pink); width: 85%; max-width: 400px; box-shadow: 0 0 40px rgba(255, 75, 110, 0.4); }
        
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; max-height: 250px; overflow-y: auto; padding: 5px; }
        .shop-item { background: #1a1a2e; padding: 12px; border-radius: 18px; font-size: 12px; cursor: pointer; border: 2px solid transparent; transition: 0.3s; }
        .shop-item.active { border-color: var(--pink); background: #2d142c; box-shadow: inset 0 0 10px var(--pink); }
        
        button { background: var(--pink); color: white; border: none; padding: 16px; border-radius: 50px; font-weight: bold; cursor: pointer; width: 100%; font-size: 18px; text-transform: uppercase; letter-spacing: 1px; }
        .author { margin-top: 20px; font-size: 9px; color: rgba(255,255,255,0.4); letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="hud">
    üí∞ <span id="coinsHUD">0</span> | ‚≠ê <span id="scoreHUD">0</span><br>
    ‚õΩ <progress id="fuelBar" value="100" max="100"></progress>
</div>

<div id="mainMenu" class="overlay">
    <div class="menu-card">
        <h2 style="margin:0; color:var(--pink); text-shadow: 0 0 10px var(--pink);">–ê–ù–ì–ê–† 806L4</h2>
        <p style="color:var(--gold)">–ë–∞–ª–∞–Ω—Å: <span id="totalCoins">0</span> üí∞</p>
        <div class="shop-grid" id="shopGrid"></div>
        <button id="startBtn">–ü–û–ï–•–ê–õ–ò! üöÄ</button>
        <div class="author">CREATED BY <b>806L4</b> | SUPPORT BY AI</div>
    </div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const shipModels = [
    { name: "–°–ø—É—Ç–Ω–∏–∫", speed: 6, hp: 1, guns: 1, price: 0, color: '#ff4b6e' },
    { name: "–†–∞–∫–µ—Ç–∞", speed: 9, hp: 1, guns: 1, price: 300, color: '#00d2ff' },
    { name: "–¢–∞–Ω–∫", speed: 4, hp: 4, guns: 1, price: 800, color: '#4caf50' },
    { name: "–î—Ä–æ–Ω", speed: 7, hp: 2, guns: 2, price: 1500, color: '#ffd700' },
    { name: "–ó–≤–µ–∑–¥–∞", speed: 11, hp: 2, guns: 3, price: 3000, color: '#9c27b0' }
];

let userData = JSON.parse(localStorage.getItem('aviator_pro_v1')) || {
    coins: 0, unlockedShips: [true, false, false, false, false], currentShipIndex: 0
};

let score = 0, fuel = 100, gameActive = false, freezeTimer = 0;
let player = { x: canvas.width/2, y: canvas.height/2, w: 46, h: 46, shield: 0 };
let enemies = [], bullets = [], items = [], stars = [];

// –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–Ω–æ–µ –Ω–µ–±–æ
for(let i=0; i<50; i++) stars.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: Math.random()*2});

function drawCustomPlane(x, y, color, isEnemy = false) {
    ctx.save();
    ctx.translate(x + 23, y + 23);
    if(isEnemy) ctx.rotate(Math.PI);

    // –¢–µ–ª–æ —Å–∞–º–æ–ª–µ—Ç–∞ (–≥—Ä–∞–¥–∏–µ–Ω—Ç)
    let grad = ctx.createLinearGradient(-10, -20, 10, 20);
    grad.addColorStop(0, color);
    grad.addColorStop(1, '#000');
    ctx.fillStyle = grad;
    
    // –ù–æ—Å
    ctx.beginPath(); ctx.moveTo(0, -22); ctx.lineTo(12, 10); ctx.lineTo(-12, 10); ctx.fill();
    // –ö—Ä—ã–ª—å—è
    ctx.fillStyle = color;
    ctx.fillRect(-23, -2, 46, 6);
    ctx.fillRect(-15, 8, 30, 4);
    // –¢—É—Ä–±–∏–Ω—ã
    ctx.fillStyle = isEnemy ? 'red' : 'cyan';
    if(!isEnemy) ctx.shadowBlur = 10; ctx.shadowColor = ctx.fillStyle;
    ctx.fillRect(-8, 12, 5, 8); ctx.fillRect(3, 12, 5, 8);
    
    ctx.restore();
}

function updateUI() {
    document.getElementById('totalCoins').innerText = userData.coins;
    document.getElementById('coinsHUD').innerText = userData.coins;
    const grid = document.getElementById('shopGrid');
    grid.innerHTML = '';
    shipModels.forEach((s, i) => {
        const active = userData.currentShipIndex === i;
        const unlocked = userData.unlockedShips[i];
        grid.innerHTML += `<div class="shop-item ${active?'active':''}" onclick="selectShip(${i})">
            <b style="color:${s.color}">${s.name}</b><br>
            ${unlocked ? '–ì–û–¢–û–í' : s.price+' üí∞'}
        </div>`;
    });
}

window.selectShip = (i) => {
    if(userData.unlockedShips[i]) userData.currentShipIndex = i;
    else if(userData.coins >= shipModels[i].price) {
        userData.coins -= shipModels[i].price; userData.unlockedShips[i] = true; userData.currentShipIndex = i;
    }
    localStorage.setItem('aviator_pro_v1', JSON.stringify(userData));
    updateUI();
};

function loop() {
    if(!gameActive) return;
    
    // –ö—Ä–∞—Å–∏–≤—ã–π —Ñ–æ–Ω (–ö–æ—Å–º–æ—Å)
    let bgGrad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    bgGrad.addColorStop(0, '#1a2a6c'); bgGrad.addColorStop(1, '#b21f1f');
    ctx.fillStyle = bgGrad; ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // –ó–≤–µ–∑–¥—ã
    ctx.fillStyle = "white";
    stars.forEach(s => { s.y += 1; if(s.y > canvas.height) s.y = 0; ctx.fillRect(s.x, s.y, s.s, s.s); });

    // –ê–≤—Ç–æ—Å—Ç—Ä–µ–ª—å–±–∞
    if(Date.now() % 150 < 20) {
        const s = shipModels[userData.currentShipIndex];
        bullets.push({x: player.x + 21, y: player.y, w: 4, h: 12});
        if(s.guns >= 2) { bullets.push({x:player.x, y:player.y+10, w:4, h:12}); bullets.push({x:player.x+42, y:player.y+10, w:4, h:12}); }
    }

    // –ò–≥—Ä–æ–∫
    drawCustomPlane(player.x, player.y, shipModels[userData.currentShipIndex].color);
    if(player.shield > 0) { 
        ctx.strokeStyle = "cyan"; ctx.lineWidth = 3; ctx.beginPath(); 
        ctx.arc(player.x+23, player.y+23, 35, 0, Math.PI*2); ctx.stroke(); 
    }

    // –í—Ä–∞–≥–∏
    if(Math.random() < 0.03 && freezeTimer <= 0) enemies.push({x: Math.random()*(canvas.width-40), y: -50, w: 46, h: 46});
    enemies.forEach((en, i) => {
        if(freezeTimer <= 0) en.y += (4 + score/1000);
        drawCustomPlane(en.x, en.y, "#333", true);
        if(intersect(player, en)) {
            if(player.shield > 0) { player.shield--; enemies.splice(i, 1); }
            else { gameActive = false; document.getElementById('mainMenu').style.display = 'flex'; updateUI(); }
        }
        bullets.forEach((b, bi) => {
            if(intersect(b, en)) { enemies.splice(i, 1); bullets.splice(bi, 1); score += 10; userData.coins += 2; }
        });
        if(en.y > canvas.height) enemies.splice(i, 1);
    });

    // –ü—É–ª–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã
    bullets.forEach((b, i) => { b.y -= 10; ctx.fillStyle = "yellow"; ctx.fillRect(b.x, b.y, b.w, b.h); if(b.y < -20) bullets.splice(i, 1); });
    
    if(Math.random() < 0.01) items.push({x: Math.random()*(canvas.width-30), y: -50, w: 30, h: 30, t: ['f','s','z'][Math.floor(Math.random()*3)]});
    items.forEach((it, i) => {
        it.y += 3;
        ctx.fillStyle = it.t==='f'?'orange':it.t==='s'?'cyan':'white';
        ctx.beginPath(); ctx.arc(it.x+15, it.y+15, 12, 0, Math.PI*2); ctx.fill();
        if(intersect(player, it)) {
            if(it.t==='f') fuel = Math.min(100, fuel + 25);
            if(it.t==='s') player.shield++;
            if(it.t==='z') freezeTimer = 180;
            items.splice(i, 1);
        }
    });

    if(freezeTimer > 0) freezeTimer--;
    fuel -= 0.07;
    document.getElementById('scoreHUD').innerText = score;
    document.getElementById('fuelBar').value = fuel;
    if(fuel <= 0) { gameActive = false; document.getElementById('mainMenu').style.display = 'flex'; updateUI(); }
    requestAnimationFrame(loop);
}

const intersect = (r1, r2) => !(r2.x > r1.x + r1.w || r2.x + r2.w < r1.x || r2.y > r1.y + r1.h || r2.y + r2.h < r1.y);

const move = (e) => {
    let x = e.clientX || (e.touches && e.touches[0].clientX);
    let y = e.clientY || (e.touches && e.touches[0].clientY);
    if(x && gameActive) { player.x = x - 23; player.y = y - 23; }
};

window.addEventListener('mousemove', move);
window.addEventListener('touchmove', (e) => { e.preventDefault(); move(e); }, {passive: false});

document.getElementById('startBtn').onclick = () => {
    gameActive = true; score = 0; fuel = 100; enemies = []; bullets = []; items = [];
    player.shield = shipModels[userData.currentShipIndex].hp - 1;
    document.getElementById('mainMenu').style.display = 'none';
    loop();
};

updateUI();
</script>
</body>
</html>
