<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aviator Elite 806L4</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        :root { --pink: #ff4b6e; --gold: #ffd700; --blue: #00d2ff; --sky: #e0f7fa; --dark: #1a2a6c; }
        * { box-sizing: border-box; -webkit-touch-callout: none; user-select: none; }
        body { margin: 0; background: var(--sky); overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; color: var(--dark); }
        canvas { display: block; width: 100%; height: 100%; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #event-bar { position: absolute; top: 0; width: 100%; background: rgba(255,255,255,0.9); color: var(--pink); font-size: 11px; padding: 6px 0; z-index: 200; overflow: hidden; border-bottom: 1px solid var(--pink); font-weight: bold; }
        #event-text { display: inline-block; white-space: nowrap; animation: scroll 20s linear infinite; padding-left: 100%; }
        @keyframes scroll { from { transform: translateX(0); } to { transform: translateX(-100%); } }

        .hud { position: absolute; top: 45px; left: 15px; z-index: 10; background: rgba(255,255,255,0.7); padding: 10px 15px; border-radius: 20px; backdrop-filter: blur(10px); border: 1px solid white; pointer-events: none; font-weight: bold; }
        
        .overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(26, 42, 108, 0.7); z-index: 100; backdrop-filter: blur(15px); }
        .menu-card { background: white; padding: 25px; border-radius: 30px; text-align: center; border: 4px solid var(--pink); width: 92%; max-width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        
        .tabs-nav { display: flex; justify-content: space-around; margin: 15px 0; background: #f0f4f8; border-radius: 15px; padding: 5px; }
        .tab-link { cursor: pointer; padding: 8px 12px; border-radius: 10px; font-size: 12px; font-weight: bold; color: #888; transition: 0.3s; }
        .tab-link.active { background: var(--pink); color: white; }

        .tab-content { display: none; max-height: 300px; overflow-y: auto; margin-top: 10px; }
        .tab-content.active { display: block; }

        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 5px; }
        .shop-item { background: #f8f9fa; padding: 12px; border-radius: 15px; border: 2px solid #eee; transition: 0.2s; position: relative; }
        .shop-item.selected { border-color: var(--pink); background: #fff0f3; }
        .shop-item img { width: 50px; height: auto; display: block; margin: 0 auto 5px; }

        input { background: #f0f4f8; border: 2px solid #ddd; padding: 12px; width: 100%; border-radius: 15px; text-align: center; margin-bottom: 10px; font-weight: bold; }
        button { background: var(--pink); color: white; border: none; padding: 15px; border-radius: 50px; font-weight: bold; width: 100%; font-size: 16px; box-shadow: 0 5px 15px rgba(255,75,110,0.3); cursor: pointer; }
        
        .leader-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; font-size: 14px; }
    </style>
</head>
<body>

<div id="event-bar"><div id="event-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º... –ü–∏–ª–æ—Ç –≥–æ—Ç–æ–≤ –∫ –≤—ã–ª–µ—Ç—É... –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º...</div></div>
<div class="hud">üí∞ <span id="hCoins">0</span> | ‚≠ê <span id="hScore">0</span></div>

<div id="mainMenu" class="overlay">
    <div class="menu-card">
        <div id="rankBadge" style="background:var(--pink); color:white; padding:5px 15px; border-radius:12px; font-size:11px; display:inline-block; margin-bottom:10px;">–ó–í–ê–ù–ò–ï: –ö–£–†–°–ê–ù–¢</div>
        <h2 id="shipNameDisplay" style="margin:5px 0;">–ê–ù–ì–ê–† 806L4</h2>
        <p id="shipDesc" style="font-size:12px; color:#666; margin-bottom:10px;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Å–∞–º–æ–ª–µ—Ç</p>
        
        <div class="tabs-nav">
            <div class="tab-link active" onclick="ui.tab('shop')">–°–ê–ú–û–õ–ï–¢–´</div>
            <div class="tab-link" onclick="ui.tab('leader')">–¢–û–ü –ú–ò–†–ê</div>
            <div class="tab-link" onclick="ui.tab('settings')">–ò–ù–§–û</div>
        </div>

        <div id="tab-shop" class="tab-content active"><div class="shop-grid" id="sGrid"></div></div>
        <div id="tab-leader" class="tab-content"><div id="lList">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div></div>
        <div id="tab-settings" class="tab-content">
            <input type="text" id="pName" placeholder="–í–∞—à –ø–æ–∑—ã–≤–Ω–æ–π" maxlength="12">
            <p>–ó–≤—É–∫: <b onclick="ui.toggle('sfx')" id="cfg-sfx" style="color:var(--pink);cursor:pointer">–í–ö–õ</b></p>
            <p>–ü–æ–¥–¥–µ—Ä–∂–∫–∞: <a href="https://t.me" style="color:var(--pink)">@camelot0</a></p>
        </div>

        <button onclick="game.start()" style="margin-top:15px;">–í–ó–õ–ï–¢ üöÄ</button>
    </div>
</div>

<canvas id="game"></canvas>

<script>
// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ë–ê–ó–´ ---
const SUPABASE_URL = '–¢–í–û–ô_URL'; 
const SUPABASE_KEY = '–¢–í–û–ô_KEY';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// --- –î–ê–ù–ù–´–ï –°–ê–ú–û–õ–ï–¢–û–í ---
const ships = [
    { n: "–Ø–∫-52", d: "–£—á–µ–±–Ω—ã–π –≤–∏–Ω—Ç. –ú–∞–Ω–µ–≤—Ä–µ–Ω–Ω—ã–π.", p: 0, g: 1, c: "#ff4b6e" },
    { n: "L-39", d: "–†–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä.", p: 500, g: 1, c: "#00d2ff" },
    { n: "–ú–∏–ì-15", d: "–õ–µ–≥–µ–Ω–¥–∞ –∫–æ—Ä–µ–π—Å–∫–æ–π –≤–æ–π–Ω—ã.", p: 1500, g: 1, c: "#4caf50" },
    { n: "F-86 Sabre", d: "–°–∫–æ—Ä–æ—Å—Ç–Ω–æ–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫.", p: 3000, g: 2, c: "#ffd700" },
    { n: "–ú–∏–ì-21", d: "–°–≤–µ—Ä—Ö–∑–≤—É–∫–æ–≤–æ–π –∫–ª–∞—Å—Å–∏–∫.", p: 7000, g: 2, c: "#9c27b0" },
    { n: "F-4 Phantom", d: "–¢—è–∂–µ–ª—ã–π –∏—Å—Ç—Ä–µ–±–∏—Ç–µ–ª—å.", p: 12000, g: 2, c: "#795548" },
    { n: "–ú–∏–ì-25", d: "–ö–æ—Ä–æ–ª—å –≤—ã—Å–æ—Ç—ã –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏.", p: 20000, g: 3, c: "#607d8b" },
    { n: "F-14 Tomcat", d: "–ö—Ä—ã–ª—å—è —Å –∏–∑–º–µ–Ω—è–µ–º–æ–π –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π.", p: 30000, g: 3, c: "#3f51b5" },
    { n: "–°—É-27", d: "–õ—É—á—à–∞—è –º–∞–Ω–µ–≤—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –º–∏—Ä–µ.", p: 45000, g: 3, c: "#03a9f4" },
    { n: "F-15 Eagle", d: "–†–µ–∫–æ—Ä–¥—Å–º–µ–Ω –≤–æ–∑–¥—É—à–Ω—ã—Ö –±–æ–µ–≤.", p: 60000, g: 4, c: "#8bc34a" },
    { n: "–ú–∏–ì-31", d: "–î–∞–ª—å–Ω–∏–π —Å—Ç—Ä–∞–∂ –Ω–µ–±–∞.", p: 75000, g: 4, c: "#ff9800" },
    { n: "F-22 Raptor", d: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –°—Ç–µ–ª—Å 5-–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è.", p: 95000, g: 4, c: "#212121" },
    { n: "–°—É-57", d: "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–π –∞–≤–∏–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å.", p: 120000, g: 5, c: "#455a64" },
    { n: "SR-71", d: "–†–∞–∑–≤–µ–¥—á–∏–∫ –Ω–∞ –∫—Ä–∞—é –∫–æ—Å–º–æ—Å–∞.", p: 160000, g: 5, c: "#1a1a1a" },
    { n: "Starship", d: "–ú–µ–∂–ø–ª–∞–Ω–µ—Ç–Ω—ã–π –∫–æ—Ä–∞–±–ª—å SpaceX.", p: 250000, g: 6, c: "gold" }
];

const ranks = [
    { m: 0, t: "–ö–£–†–°–ê–ù–¢" }, { m: 1000, t: "–ü–ò–õ–û–¢" }, { m: 5000, t: "–ê–°" },
    { m: 15000, t: "–ú–ê–ô–û–†" }, { m: 50000, t: "–ì–ï–ù–ï–†–ê–õ" }, { m: 100000, t: "–ú–ê–†–®–ê–õ" }
];

// --- –Ø–î–†–û –°–ò–°–¢–ï–ú–´ ---
let db = JSON.parse(localStorage.getItem('avi_806')) || { n: "–ü–∏–ª–æ—Ç", c: 0, u: [true], cur: 0, hi: 0, cfg: {sfx:true} };
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const ui = {
    tab: (n) => {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
        document.getElementById('tab-'+n).classList.add('active');
        event.target.classList.add('active');
        if(n === 'leader') ui.loadLeaderboard();
    },
    renderShop: () => {
        const grid = document.getElementById('sGrid');
        grid.innerHTML = '';
        ships.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = `shop-item ${db.cur === i ? 'selected' : ''}`;
            div.innerHTML = `<b>${s.n}</b><br><small>${db.u[i] ? '–í–ó–õ–ï–¢' : s.p+' üí∞'}</small>`;
            div.onclick = () => {
                if(db.u[i]) { db.cur = i; }
                else if(db.c >= s.p) { db.c -= s.p; db.u[i] = true; db.cur = i; }
                document.getElementById('shipNameDisplay').innerText = s.n;
                document.getElementById('shipDesc').innerText = s.d;
                ui.save(); ui.renderShop();
            };
            grid.appendChild(div);
        });
        document.getElementById('hCoins').innerText = db.c;
        const rank = ranks.slice().reverse().find(r => db.hi >= r.m).t;
        document.getElementById('rankBadge').innerText = "–ó–í–ê–ù–ò–ï: " + rank;
    },
    save: () => localStorage.setItem('avi_806', JSON.stringify(db)),
    loadLeaderboard: async () => {
        const { data } = await sb.from('leaderboard').select('*').order('score', { ascending: false }).limit(10);
        if(data) {
            document.getElementById('lList').innerHTML = data.map((p, i) => 
                `<div class="leader-row"><span>${i+1}. ${p.name}</span><b>${p.score}</b></div>`).join('');
        }
    }
};

// --- –ò–ì–†–û–í–û–ô –î–í–ò–ñ–û–ö ---
const game = {
    active: false,
    score: 0,
    player: { x: 0, y: 0, tx: 0, ty: 0 },
    bullets: [], enemies: [],
    start: () => {
        db.n = document.getElementById('pName').value || "–ü–∏–ª–æ—Ç";
        ui.save();
        document.getElementById('mainMenu').style.display = 'none';
        game.active = true; game.score = 0; game.enemies = []; game.bullets = [];
        game.player.x = canvas.width/2; game.player.y = canvas.height - 100;
        game.loop();
        game.spawn();
    },
    spawn: () => {
        if(!game.active) return;
        game.enemies.push({ x: Math.random()*canvas.width, y: -50, s: 3 + Math.random()*3 });
        setTimeout(game.spawn, 1000 - Math.min(game.score/5, 700));
    },
    loop: () => {
        if(!game.active) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        game.player.x += (game.player.tx - game.player.x) * 0.1;
        game.player.y += (game.player.ty - game.player.y) * 0.1;

        // –°—Ç—Ä–µ–ª—å–±–∞
        if(Date.now() % 150 < 20) game.bullets.push({x: game.player.x, y: game.player.y - 20});

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–∞
        ctx.fillStyle = ships[db.cur].c;
        ctx.beginPath(); ctx.arc(game.player.x, game.player.y, 20, 0, Math.PI*2); ctx.fill();

        // –ü—É–ª–∏ –∏ –í—Ä–∞–≥–∏
        game.bullets.forEach((b, i) => {
            b.y -= 12;
            ctx.fillStyle = 'orange'; ctx.fillRect(b.x-2, b.y, 4, 10);
            if(b.y < 0) game.bullets.splice(i, 1);
        });

        game.enemies.forEach((en, i) => {
            en.y += en.s;
            ctx.fillStyle = var(--dark); ctx.fillRect(en.x-15, en.y-15, 30, 30);
            
            // –ö–æ–ª–ª–∏–∑–∏–∏
            game.bullets.forEach((b, bi) => {
                if(Math.hypot(en.x - b.x, en.y - b.y) < 25) {
                    game.enemies.splice(i, 1); game.bullets.splice(bi, 1);
                    game.score += 10; db.c += 1;
                    document.getElementById('hScore').innerText = game.score;
                    document.getElementById('hCoins').innerText = db.c;
                }
            });

            if(Math.hypot(en.x - game.player.x, en.y - game.player.y) < 35) game.over();
            if(en.y > canvas.height) game.enemies.splice(i, 1);
        });

        requestAnimationFrame(game.loop);
    },
    over: async () => {
        game.active = false;
        if(game.score > db.hi) {
            db.hi = game.score;
            await sb.from('leaderboard').insert([{ name: db.n, score: db.hi }]);
        }
        ui.save();
        alert("–°–ê–ú–û–õ–ï–¢ –°–ë–ò–¢! –°—á–µ—Ç: " + game.score);
        location.reload();
    }
};

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
window.dispatchEvent(new Event('resize'));
canvas.addEventListener('touchmove', (e) => { e.preventDefault(); game.player.tx = e.touches[0].clientX; game.player.ty = e.touches[0].clientY; }, {passive:false});
canvas.addEventListener('mousemove', (e) => { game.player.tx = e.clientX; game.player.ty = e.clientY; });

ui.renderShop();
</script>
</body>
</html>
